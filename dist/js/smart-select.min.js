"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var l=0;l<t.length;l++){var s=t[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,l,s){return l&&e(t.prototype,l),s&&e(t,s),t}}();!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):window.jQuery||window.Zepto)}(function(e){var t="smartSelect",l={toggleButton:!1,wrapperClass:"ms-parent",textStandard:"Placeholder",textCountSelected:"%d Selected",textAllSelected:"All selected",textSelectAll:"Select all",textUnselectAll:"Unselect all"},s=function(){function t(s,i){_classCallCheck(this,t),this.$el=this.$el=e(s),this.$container="",this.$button="",this.$dropdown="",this.changeListener=!0,this.selectedValue="",this.options=e.extend(!0,{},l,i),this._defaults={multiple:!1},this._defaults.multiple=!!this.$el.attr("multiple"),this._resetSelectedValue(),this._buildElement(),this._syncOption(),this._bindListener()}return _createClass(t,[{key:"_buildElement",value:function(){this.$container=e('<div class="'+this.options.wrapperClass+'"></div>'),this.$button=e('<button type="button" class="ms-choice"><span></span><div></div></button>'),this.$dropdown=e('<div class="ms-drop '+(this._defaults.multiple?"multiple":"")+'"></div>'),this.$container.append(this.$button).append(this.$dropdown),this.$el.after(this.$container),this.$el.hide()}},{key:"_setSelectedValue",value:function(e){if(this._defaults.multiple){var t=this.selectedValue.indexOf(e);t>=0?this.selectedValue.splice(t,1):this.selectedValue.push(e)}else this.selectedValue=e}},{key:"_resetSelectedValue",value:function(){this._defaults.multiple?this.selectedValue=[]:this.selectedValue=""}},{key:"_syncOption",value:function(){var t=this,l="<ul>";this._defaults.multiple&&this.options.toggler&&(l+='\n                <li class="select-toggle" data-value="" data-translate-toggle="'+this.options.textUnselectAll+'">\n                    '+this.options.textSelectAll+"\n                </li>"),this._resetSelectedValue(),this.$el.find("option").each(function(s,i){var n="",o=e(i);o.is(":selected")&&(t._setSelectedValue(o.val()),n="selected"),l+='\n                <li class="'+n+'" data-value="'+o.val()+'">\n                    '+o.text()+"\n                </li>"}),l+="</ul>",this.$el.find("option:selected").attr("selected",null),this.$el.val(this.selectedValue),this.$dropdown.html(l),this._defaults.multiple&&this.options.toggler&&(this.$toggler=this.$dropdown.find("li.select-toggle")),this._setLabel(),this._bindEvent()}},{key:"_bindListener",value:function(){var t=this;this.$el.on("change",function(){t.changeListener&&t._syncOption()}),this.$button.on("click",function(){t._toggleList()}),e(window).click(function(l){t.$button.find(">div").hasClass("open")&&(e(l.target)[0]===t.$button[0]||e(l.target).parents(".ms-choice")[0]===t.$button[0]||e(l.target)[0]===t.$dropdown[0]||e(l.target).parents(".ms-drop")[0]===t.$dropdown[0]||t._toggleList(!1))})}},{key:"_setLabel",value:function(){var e=this.$el.find("option:first").text(),t=this.$el.find('option[value=""]');if(t.length&&(e=t.text()),this._defaults.multiple){e=this.options.textStandard;var l=this.$dropdown.find("li:not(.select-toggle)");this.options.toggler&&this._setToggleLabel(!1),this.selectedValue.length>=2&&this.selectedValue.length<l.length?e=this.options.textCountSelected.replace("%d",this.selectedValue.length):this.selectedValue.length===l.length?(e=this.options.textAllSelected,this.options.toggler&&this._setToggleLabel(!0)):1===this.selectedValue.length&&(e=this.$el.find('option[value="'+this.selectedValue[0]+'"]').text())}else this.selectedValue?e=this.$el.find('option[value="'+this.selectedValue+'"]').text():0===this.selectedValue&&(e=this.$el.find('option[value="0"]').text());this.$button.find("span").text(e)}},{key:"_setToggleLabel",value:function(e){if(e){if(this.$toggler.hasClass("selected"))return}else if(!this.$toggler.hasClass("selected"))return;this.$toggler.toggleClass("selected",e);var t=this.$toggler.text();this.$toggler.text(this.$toggler.data("translate-toggle")),this.$toggler.data("translate-toggle",t)}},{key:"_bindEvent",value:function(){var t=this,l=this;this.$dropdown.find("li:not(.select-toggle)").off("click").on("click",function(){l._updateSelected(e(this).data("value")),l._defaults.multiple||l._toggleList(!1)}),this._defaults.multiple&&this.options.toggler&&this.$toggler.off("click").on("click",function(){t._toggleAll()})}},{key:"_toggleAll",value:function(){if(this.$toggler.hasClass("selected"))this._resetSelectedValue(),this.$el.val([]),this.$dropdown.find("li:not(.select-toggle)").removeClass("selected"),this._setToggleLabel(!1);else{var t=[];this.$el.find("option").each(function(){t.push(e(this).val())}),this.selectedValue=t,this.$el.val(this.selectedValue),this.$dropdown.find("li:not(.select-toggle)").addClass("selected"),this._setToggleLabel(!0)}this._setLabel(),this.changeListener=!1,this.$el.change(),this.changeListener=!0}},{key:"_toggleList",value:function(t){e(document).find(".ms-choice > div").not(this.$button.find("> div")).toggleClass("open",!1),e(document).find(".ms-drop").not(this.$dropdown).toggle(!1),this.$button.find(">div").toggleClass("open",t),this.$dropdown.toggle(t)}},{key:"_updateSelected",value:function(e){this._setSelectedValue(e),this.$el.val(this.selectedValue),this._setLabel(),this._defaults.multiple?this.$dropdown.find('li[data-value="'+e+'"]').toggleClass("selected"):(this.$dropdown.find("li.selected").removeClass("selected"),this.$dropdown.find('li[data-value="'+e+'"]').addClass("selected")),this.changeListener=!1,this.$el.change(),this.changeListener=!0}},{key:"refresh",value:function(){this._syncOption()}},{key:"destroy",value:function(){this.$container.remove(),this.$el.show()}}]),t}();e.fn[t]=function(l){var i=arguments;if(void 0===l||"object"==typeof l)return this.each(function(){e.data(this,"plugin_"+t)||e.data(this,"plugin_"+t,new s(this,l))});if("string"==typeof l&&"_"!==l[0]&&"init"!==l){var n;return this.each(function(){var s=e.data(this,"plugin_"+t);"function"==typeof s[l]&&(n=s[l].apply(s,Array.prototype.slice.call(i,1))),"destroy"===l&&e.data(this,"plugin_"+t,null)}),void 0!==n?n:this}}});